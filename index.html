<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 YEAR END - HQ ARCHIVE</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- html2canvas for PNG Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Google Fonts: Gowun Dodum -->
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Gowun Dodum', sans-serif;
            background-color: #fdfcfb;
            color: #1e293b;
            margin: 0;
            overflow-x: hidden;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        .animate-pulse-custom {
            animation: pulse 4s ease-in-out infinite;
        }

        /* 캡처 시 제외할 요소 */
        .no-export {
            display: none !important;
        }

        .polaroid-card {
            transition: all 0.3s ease;
        }
        .polaroid-card:hover {
            transform: translateY(-8px) rotate(0deg) !important;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        /* 월별 랜덤 회전 */
        .rotate-pos { transform: rotate(1deg); }
        .rotate-neg { transform: rotate(-1deg); }

        /* 캡처를 위한 래퍼 스타일 */
        #capture-area {
            background-color: #fdfcfb;
            position: relative;
        }
    </style>
</head>
<body>
    <div id="capture-area" class="min-h-screen p-4 md:p-10">
        <!-- 배경 장식 (눈송이 및 반짝이) -->
        <div id="background-decor" class="fixed inset-0 pointer-events-none overflow-hidden z-0 fixed-decor"></div>

        <!-- 고정 위치 아이콘 데코레이션 -->
        <div class="fixed top-10 right-10 opacity-10 pointer-events-none hidden xl:block animate-float fixed-decor text-[#064e3b]">
            <i data-lucide="trees" style="width: 120px; height: 120px;"></i>
        </div>
        <div class="fixed bottom-10 left-10 opacity-10 pointer-events-none hidden xl:block fixed-decor text-[#d63031] fill-[#d63031]">
            <i data-lucide="heart" style="width: 100px; height: 100px;"></i>
        </div>

        <div class="relative z-10">
            <header class="max-w-4xl mx-auto text-center mb-12 pt-6">
                <!-- 타이틀 배지 -->
                <div class="inline-block bg-[#d63031] text-white px-8 py-2 rounded-full text-sm md:text-xl font-black tracking-[0.1em] mb-4 shadow-lg transform -rotate-1 border-2 border-white/20 uppercase">
                    HQ ARCHIVE
                </div>
                
                <!-- 메인 타이틀 -->
                <h1 class="text-[2.8rem] sm:text-6xl md:text-8xl lg:text-[7rem] font-[800] tracking-tighter leading-none text-slate-900 italic flex flex-wrap items-center justify-center gap-x-3 gap-y-1 uppercase">
                    <span class="inline-block">2025</span>
                    <span class="text-[#d63031] inline-block whitespace-nowrap">YEAR END</span>
                </h1>
                
                <!-- 하단 구분선 -->
                <div class="mt-8 flex justify-center items-center gap-3 opacity-20">
                    <div class="h-[2px] w-12 bg-slate-300"></div>
                    <i data-lucide="heart" class="w-4 h-4"></i>
                    <div class="h-[2px] w-12 bg-slate-300"></div>
                </div>
            </header>

            <!-- 12개월 그리드 카드 영역 -->
            <main id="grid-container" class="max-w-5xl mx-auto grid grid-cols-3 sm:grid-cols-4 gap-3 md:gap-8 relative z-10 px-2 pb-20">
                <!-- JavaScript에서 동적으로 생성됩니다 -->
            </main>

            <!-- 푸터 영역 -->
            <footer class="max-w-4xl mx-auto text-center space-y-8 pb-16 relative z-10">
                <div id="action-buttons" class="flex flex-col items-center gap-4">
                    <button id="save-btn" onclick="saveAsPng()" class="inline-flex items-center gap-3 bg-[#d63031] text-white px-10 py-4 rounded-full font-black shadow-2xl shadow-rose-200/50 hover:bg-[#b32626] hover:scale-105 transition-all text-sm md:text-xl active:scale-95">
                        <i data-lucide="download" class="w-6 h-6"></i>
                        사진으로 저장하기
                    </button>
                    <p id="loading-msg" class="hidden text-[#d63031] font-bold animate-pulse text-sm">이미지를 생성 중입니다...</p>
                </div>
                
                <div class="flex flex-col items-center gap-3 opacity-40">
                    <p class="font-bold text-[11px] md:text-sm tracking-[0.2em] text-slate-500 uppercase">
                        copyright 2025. Penta_1031
                    </p>
                    <div class="flex gap-4 text-[#d63031]">
                        <i data-lucide="heart" class="w-4 h-4 fill-current"></i>
                        <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                        <i data-lucide="heart" class="w-4 h-4 fill-current"></i>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <script>
        // 초기 데이터 설정
        const months = Array.from({ length: 12 }, (_, i) => ({
            id: i + 1,
            image: null
        }));

        const gridContainer = document.getElementById('grid-container');
        const backgroundDecor = document.getElementById('background-decor');

        // 배경 눈송이 생성
        function createDecor() {
            backgroundDecor.innerHTML = ''; 
            for (let i = 0; i < 25; i++) {
                const div = document.createElement('div');
                div.className = 'absolute animate-pulse-custom opacity-40';
                div.style.left = Math.random() * 100 + '%';
                div.style.top = Math.random() * 100 + '%';
                div.style.animationDuration = (Math.random() * 4 + 3) + 's';
                div.style.animationDelay = (Math.random() * 5) + 's';
                
                const iconName = i % 2 === 0 ? 'snowflake' : 'sparkles';
                const colorClass = i % 2 === 0 ? 'text-white' : 'text-[#fbbf24]';
                const size = i % 2 === 0 ? (Math.random() * 15 + 10) : (Math.random() * 10 + 5);
                
                div.innerHTML = `<i data-lucide="${iconName}" class="${colorClass}" style="width: ${size}px; height: ${size}px;"></i>`;
                backgroundDecor.appendChild(div);
            }
            lucide.createIcons();
        }

        // 그리드 렌더링
        function renderGrid() {
            gridContainer.innerHTML = '';
            months.forEach((item, index) => {
                const card = document.createElement('div');
                const rotationClass = index % 2 === 0 ? 'rotate-pos' : 'rotate-neg';
                card.className = `polaroid-card relative group bg-white p-2 md:p-5 shadow-[0_20px_40px_rgba(0,0,0,0.06)] rounded-2xl border-b-8 border-slate-100 ${rotationClass}`;
                
                const tapeColor = index % 2 === 0 ? 'bg-[#d63031]' : 'bg-[#059669]';
                const tapeRotate = index % 2 === 0 ? '-rotate-3' : 'rotate-2';

                card.innerHTML = `
                    <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-10 md:w-16 h-4 md:h-7 z-20 transform rounded-full shadow-md ${tapeColor} ${tapeRotate} opacity-90 border-2 border-white/20"></div>
                    <div class="text-sm md:text-xl font-black mb-1 md:mb-3 flex justify-between items-center px-1">
                        <span class="text-[#d63031] italic">${String(item.id).padStart(2, '0')}</span>
                        <i data-lucide="snowflake" class="text-blue-100 w-4 h-4"></i>
                    </div>
                    <div class="relative aspect-square bg-slate-50 rounded-xl overflow-hidden cursor-pointer flex items-center justify-center border-2 border-slate-50 group-hover:border-[#d63031]/20 transition-all shadow-inner" onclick="triggerUpload(${item.id})">
                        ${item.image ? `
                            <img src="${item.image}" class="w-full h-full object-cover">
                            <button onclick="event.stopPropagation(); removeImage(${item.id})" class="export-hide absolute top-2 right-2 bg-black/40 text-white p-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-sm shadow-lg hover:bg-[#d63031]">
                                <i data-lucide="trash-2" class="w-3 h-3 md:w-4 md:h-4"></i>
                            </button>
                        ` : `
                            <div class="flex flex-col items-center text-slate-200 group-hover:text-[#74b9ff] transition-all">
                                <i data-lucide="camera" class="w-6 h-6 md:w-10 md:h-10"></i>
                                <span class="text-[10px] font-bold mt-1 opacity-0 group-hover:opacity-100">PHOTO</span>
                            </div>
                        `}
                        <input type="file" id="input-${item.id}" class="hidden" accept="image/*" onchange="handleFile(${item.id}, event)">
                    </div>
                `;
                gridContainer.appendChild(card);
            });
            lucide.createIcons();
        }

        function triggerUpload(id) {
            const input = document.getElementById(`input-${id}`);
            if (input) input.click();
        }

        function handleFile(id, event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const month = months.find(m => m.id === id);
                    if (month) {
                        month.image = e.target.result;
                        renderGrid();
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        function removeImage(id) {
            const month = months.find(m => m.id === id);
            if (month) {
                month.image = null;
                renderGrid();
            }
        }

        // 이미지 저장 함수
        async function saveAsPng() {
            const saveBtn = document.getElementById('save-btn');
            const loadingMsg = document.getElementById('loading-msg');
            const captureArea = document.getElementById('capture-area');
            const exportHideElements = document.querySelectorAll('.export-hide');
            
            // UI 정리
            saveBtn.style.display = 'none';
            loadingMsg.classList.remove('hidden');
            exportHideElements.forEach(el => el.classList.add('no-export'));

            try {
                const canvas = await html2canvas(captureArea, {
                    scale: 2, 
                    useCORS: true, 
                    backgroundColor: '#fdfcfb',
                    logging: false,
                    windowWidth: captureArea.scrollWidth,
                    windowHeight: captureArea.scrollHeight
                });

                const link = document.createElement('a');
                link.download = `2025_HQ_ARCHIVE_Penta1031.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            } catch (err) {
                console.error('저장 중 오류 발생:', err);
            } finally {
                // UI 복구
                saveBtn.style.display = 'inline-flex';
                loadingMsg.classList.add('hidden');
                exportHideElements.forEach(el => el.classList.remove('no-export'));
            }
        }

        window.onload = () => {
            createDecor();
            renderGrid();
        };
    </script>
</body>
</html>